import{a as ke}from"./chunk-LI5VDDHD.js";import{c as T,d as Pe,e as Z,f as Ve}from"./chunk-5L7HWFDQ.js";import{a as _e,b as S,c as Ce,d as Se,e as be,f as Y,h as C,i as ye,k as Ae,l as xe,m as Te,n as Ee,o as Fe,p as Ne,q as we}from"./chunk-MWSYLOKK.js";import{$a as m,Ba as P,Da as pe,Ea as de,Ga as v,Gb as fe,H as le,Jb as ge,L as me,Ma as s,Oa as d,Pa as V,Qa as D,R as w,Ra as I,Sa as n,Ta as o,Ua as y,Va as x,Wa as f,X as u,Xa as g,Y as h,a as J,ab as ce,b as Q,bb as F,db as _,eb as ue,fa as W,fb as he,g as re,ga as k,gb as c,hb as M,ia as E,o as ae,qb as X,rb as ve,sa as a,wa as se,zb as q}from"./chunk-SATRGR2K.js";var qe=(i,t)=>({cp:i,"no-cursor":t}),Le=i=>({"selected-border":i}),Oe=(i,t)=>({"muted-text":i,"available-text-label":t}),$e=(i,t)=>({"available-text":i,"unavailable-text":t});function Ge(i,t){if(i&1){let e=x();n(0,"div",2)(1,"div",3)(2,"a",4),f("click",function(){let l=u(e).$implicit,p=g();return h(l.isAvailable?p.selectSlot(l):"")})("mouseleave",function(){u(e);let l=g();return h(l.elementTouched())}),n(3,"div",5)(4,"h6",6),m(5),o(),n(6,"p",7),m(7),o()()()()()}if(i&2){let e=t.$implicit;s("ngClass",M(6,qe,e.isAvailable,!e.isAvailable)),a(),s("ngClass",c(9,Le,e.isSelected)),a(3),s("ngClass",M(11,Oe,!e.isAvailable,e.isAvailable)),a(),F(" ",e.label," "),a(),s("ngClass",M(14,$e,e.isAvailable,!e.isAvailable)),a(),F(" ",e.isAvailable?"Available":"Unavailable"," ")}}var L=class i{slots=Ve;bookedSlots=k.required();availableSlots=ve(()=>this.deriveAvailableSlots(this.bookedSlots()));selectedTimeEmitter=W();touchedEmitter=W();deriveAvailableSlots(t){return this.slots.map(r=>Q(J({},r),{isAvailable:!t.includes(String(r.value))}))}selectSlot(t){this.availableSlots.update(e=>e.map(r=>Q(J({},r),{isSelected:r.value==t.value}))),this.selectedTimeEmitter.emit(t.value)}elementTouched(){this.touchedEmitter.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-time-picker"]],inputs:{bookedSlots:[1,"bookedSlots"]},outputs:{selectedTimeEmitter:"selectedTimeEmitter",touchedEmitter:"touchedEmitter"},decls:4,vars:0,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-6","col-md-4","col-lg-3","mb-3",3,"ngClass"],[1,"card","text-center","shadow-sm","time-card",3,"ngClass"],[1,"text-decoration-none",3,"click","mouseleave"],[1,"card-body","pad-4"],[1,"card-title","fw-bold","mb-1",3,"ngClass"],[1,"card-text","small","mb-0",3,"ngClass"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1),D(2,Ge,8,17,"div",2,V),o()()),e&2&&(a(2),I(r.availableSlots()))},dependencies:[q],styles:[".pad-4[_ngcontent-%COMP%]{padding:4px}.cp[_ngcontent-%COMP%]{cursor:pointer}.no-cursor[_ngcontent-%COMP%]{cursor:not-allowed}.available-text-label[_ngcontent-%COMP%]{background-image:linear-gradient(to right,green,#4caf50);display:inline;-webkit-background-clip:text;background-clip:text;color:transparent}.available-text[_ngcontent-%COMP%]{color:green}.unavailable-text[_ngcontent-%COMP%]{color:#f47a7a}.time-card[_ngcontent-%COMP%]{transition:transform .9s;background-color:#0085f205}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.selected-border[_ngcontent-%COMP%]{border:2px solid green}.muted-text[_ngcontent-%COMP%]{--bs-text-opacity: 1;color:#727a83bf!important}button[_ngcontent-%COMP%]{border:none;padding:0}"]})};var N=class i{http=w(fe);selectedDate=E(T(new Date,"MM/dd/yyyy"));availableSlotsForSelectedDate=ge(()=>`checkIfAppointIsAlreadySchedudForToday?date=${this.selectedDate()}`,{defaultValue:[],parse:t=>t.data.filter(l=>l.status==="confirmed").map(l=>l.time)});scheduleAppointment(t){return this.http.post("schedule",t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=me({token:i,factory:i.\u0275fac})};var $=class i{constructor(t){this.ngControl=t}onModelChange(t){this.ngControl&&this.onInputChange(t)}onInputChange(t){let e=t.replace(/\D/g,"");e.length>3&&e.length<=6?e=e.replace(/^(\d{0,3})(\d{0,3})/,"$1-$2"):e.length>6&&e.length<=10&&(e=e.replace(/^(\d{0,3})(\d{0,3})(\d{0,4})/,"$1-$2-$3")),this.ngControl?.valueAccessor?.writeValue(e)}static \u0275fac=function(e){return new(e||i)(se(Ce,8))};static \u0275dir=pe({type:i,selectors:[["","appPhoneNumberMask",""]],hostBindings:function(e,r){e&1&&f("ngModelChange",function(p){return r.onModelChange(p)})}})};var G=class i{transform(t){if(!t||t==="0")return"";let e=t.toString().trim();return/\D/.test(e)?e:e.length===10?`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`:e}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=de({name:"telephone",type:i,pure:!0})};var b=i=>({"invalid-label":i}),je=()=>[1,2,3,4];function Be(i,t){if(i&1){let e=x();n(0,"div",3)(1,"strong"),m(2),o(),n(3,"button",31),f("click",function(){u(e);let l=g();return h(l.closeAlert())}),n(4,"span",32),m(5,"\xD7"),o()()()}if(i&2){let e=g();a(2),ce(e.scheduleAppointmentError())}}function He(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Ue(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Ke(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function ze(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Je(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Qe(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function We(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Xe(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Ye(i,t){i&1&&(n(0,"div",33),y(1,"div",34),o())}function Ze(i,t){i&1&&(n(0,"div",26),D(1,Ye,2,0,"div",33,V),o()),i&2&&(a(),I(he(0,je)))}function et(i,t){if(i&1){let e=x();n(0,"app-time-picker",35),f("selectedTimeEmitter",function(l){u(e);let p=g();return h(p.selectedTime(l))})("touchedEmitter",function(){u(e);let l=g();return h(l.touchedEvent())}),o()}if(i&2){let e=g();s("bookedSlots",e.engagedSlotsList())}}var De=class i{appointmentApiService=w(N);type=k.required();engagedSlotsList=X(()=>this.appointmentApiService.availableSlotsForSelectedDate.value());engagedSlotsListIsLoading=X(()=>this.appointmentApiService.availableSlotsForSelectedDate.isLoading());appointmentForm;minDate=T(ke(new Date,0),Z);scheduleApointmentApiProgress=E(!1);scheduleAppointmentError=E("");unsubscribe=new re;ngOnInit(){console.log(this.type()),this.#t(),this.appointmentForm.get("appointment.date").valueChanges.pipe(ae(t=>this.#e(t)),le(this.unsubscribe)).subscribe(t=>{this.appointmentApiService.selectedDate.set(t)})}#e(t){let[e,r,l]=t.split("-").map(Number),p=new Date(e,r-1,l);return T(p,Pe)}#t(){this.appointmentForm=new Y({firstName:new C("",{nonNullable:!0,validators:[S.required]}),lastName:new C("",{nonNullable:!0,validators:[S.required]}),email:new C("",{nonNullable:!0,validators:[S.required]}),phoneNumber:new C("",{nonNullable:!0,validators:[S.required]}),serviceType:new C(this.type(),{nonNullable:!0,validators:[S.required]}),note:new C("",{nonNullable:!0}),appointment:new Y({date:new C(T(new Date,Z),{nonNullable:!0,validators:[S.required]}),time:new C("",{nonNullable:!0,validators:[S.required]})})})}selectedTime(t){this.appointmentForm.get("appointment.time").setValue(t)}onPhoneNumber(){this.appointmentForm.get("phoneNumber").setValue(new G().transform(this.appointmentForm.get("phoneNumber").value))}scheduleAppointment(){if(this.scheduleAppointmentError.set(""),console.log(this.appointmentForm.getRawValue()),this.appointmentForm.valid){this.scheduleApointmentApiProgress.set(!0);let t=this.appointmentForm.getRawValue();t.appointment.date=this.#e(t.appointment.date),t.email=t.email.toLocaleLowerCase(),this.appointmentApiService.scheduleAppointment(t).subscribe({next:e=>this.#n(e),error:e=>this.#i(e)})}else this.appointmentForm.markAllAsTouched()}#i(t){this.scheduleApointmentApiProgress.set(!1),t?.status==409?this.scheduleAppointmentError.set(t?.error?.message):this.scheduleAppointmentError.set("Failed to create Appointment for Technical Reasons. Please try later."),window.scrollTo({top:0,behavior:"smooth"})}#n(t){this.appointmentApiService.availableSlotsForSelectedDate.reload(),this.appointmentForm.reset(),this.scheduleApointmentApiProgress.set(!1)}touchedEvent(){this.appointmentForm.get("appointment.time").touched||this.appointmentForm.get("appointment.time").markAsTouched({emitEvent:!0})}preventTyping(t){t.preventDefault()}closeAlert(){this.scheduleAppointmentError.set("")}ngOnDestroy(){this.unsubscribe.next(!0),this.unsubscribe.complete()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-schedule-appointment"]],inputs:{type:[1,"type"]},features:[ue([N])],decls:80,vars:37,consts:[[1,"info_container"],[1,""],[1,"test-clip"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"container","mt-4"],[3,"formGroup"],[1,"row"],[1,"col-12","col-md-4","mb-3"],[1,"form-floating"],["type","text","id","firstName","formControlName","firstName","placeholder","First Name",1,"form-control","apt-form-control"],["for","firstName",3,"ngClass"],[1,"apt-validation"],["type","text","id","lastName","formControlName","lastName","placeholder","Last Name",1,"form-control","apt-form-control"],["for","lastName",3,"ngClass"],["type","email","id","email","formControlName","email","placeholder","Email",1,"form-control","apt-form-control"],["for","email",3,"ngClass"],["type","tel","minlength","12","maxlength","12","appPhoneNumberMask","","id","phone","formControlName","phoneNumber","placeholder","Phone",1,"form-control","apt-form-control",3,"blur"],["for","phone",3,"ngClass"],["type","text","minlength","12","maxlength","12","id","serviceType","formControlName","serviceType","placeholder","serviceType",1,"form-control","apt-form-control"],["id","note","formControlName","note","rows","1",1,"form-control"],["for","note",1,"form-label",3,"ngClass"],["formGroupName","appointment"],["type","date","id","date","formControlName","date",1,"form-control","apt-form-control",3,"keydown","min"],["for","date",3,"ngClass"],[1,"col-12","col-md-12","mb-3"],["for","time",1,"form-label","test-clip",3,"ngClass"],[1,"row","g-3","mt-4"],[3,"bookedSlots"],[1,"col-12","text-end"],[1,"btn","btn-primary","rounded-pill","px-4","shadow-sm",3,"click"],[1,"btn","btn-outline-warning","rounded-pill","px-4","ms-2"],["type","button","data-dismiss","alert","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"col-6","col-md-4","col-lg-3","mb-3"],[1,"skeleton-slot"],[3,"selectedTimeEmitter","touchedEmitter","bookedSlots"]],template:function(e,r){if(e&1){let l=x();n(0,"div",0)(1,"div",1)(2,"div",1)(3,"h4",2),m(4," Schedule Appointmment "),o()(),n(5,"div"),v(6,Be,6,1,"div",3),n(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7),_(11)(12),n(13,"div",8),y(14,"input",9),n(15,"label",10),m(16,"First Name *"),o()(),v(17,He,2,0,"div",11),o(),n(18,"div",7),_(19)(20),n(21,"div",8),y(22,"input",12),n(23,"label",13),m(24,"Last Name *"),o()(),v(25,Ue,2,0,"div",11),o(),n(26,"div",7),_(27)(28),n(29,"div",8),y(30,"input",14),n(31,"label",15),m(32,"Email address *"),o()(),v(33,Ke,2,0,"div",11),o(),n(34,"div",7),_(35)(36),n(37,"div",8)(38,"input",16),f("blur",function(){return u(l),h(r.onPhoneNumber())}),o(),n(39,"label",17),m(40,"Phone *"),o()(),v(41,ze,2,0,"div",11),o(),n(42,"div",7),_(43)(44),n(45,"div",8),y(46,"input",18),n(47,"label",17),m(48,"Service Type *"),o()(),v(49,Je,2,0,"div",11),o(),n(50,"div",7),_(51)(52),n(53,"div",8),y(54,"textarea",19),n(55,"label",20),m(56,"Notes *"),o()(),v(57,Qe,2,0,"div",11),o(),n(58,"div",21)(59,"div",7),_(60)(61),n(62,"div",8)(63,"input",22),f("keydown",function(A){return u(l),h(r.preventTyping(A))}),o(),n(64,"label",23),m(65,"Appointment Date *"),o()(),v(66,We,2,0,"div",11),o(),n(67,"div",24),_(68)(69),n(70,"label",25),m(71,"Appointment Time *"),o(),v(72,Xe,2,0,"div",11)(73,Ze,3,1,"div",26)(74,et,1,1,"app-time-picker",27),o()(),n(75,"div",28)(76,"button",29),f("click",function(){return u(l),h(r.scheduleAppointment())}),m(77),o(),n(78,"button",30),m(79,"Cancel"),o()()()()()()()()}if(e&2){a(6),d(r.scheduleAppointmentError()?6:-1),a(2),s("formGroup",r.appointmentForm);let l=r.appointmentForm.get("firstName"),p=l.touched&&l.invalid&&l.hasError("required");a(7),s("ngClass",c(21,b,p)),a(2),d(p?17:-1);let A=r.appointmentForm.get("lastName"),ee=A.touched&&A.invalid&&A.hasError("required");a(6),s("ngClass",c(23,b,ee)),a(2),d(ee?25:-1);let R=r.appointmentForm.get("email"),te=R.touched&&R.invalid&&R.hasError("required");a(6),s("ngClass",c(25,b,te)),a(2),d(te?33:-1);let j=r.appointmentForm.get("phoneNumber"),B=j.touched&&j.invalid&&j.hasError("required");a(6),s("ngClass",c(27,b,B)),a(2),d(B?41:-1);let H=r.appointmentForm.get("serviceType"),Ie=H.touched&&H.invalid&&H.hasError("required");a(6),s("ngClass",c(29,b,B)),a(2),d(Ie?49:-1);let U=r.appointmentForm.get("note"),ie=U.touched&&U.invalid&&U.hasError("required");a(6),s("ngClass",c(31,b,ie)),a(2),d(ie?57:-1);let K=r.appointmentForm.get("appointment.date"),ne=K.touched&&K.invalid&&K.hasError("required");a(6),s("min",r.minDate),a(),s("ngClass",c(33,b,ne)),a(2),d(ne?66:-1);let z=r.appointmentForm.get("appointment.time"),oe=z.touched&&z.invalid&&z.hasError("required");a(4),s("ngClass",c(35,b,oe)),a(2),d(oe?72:-1),a(),d(r.engagedSlotsListIsLoading()?73:74),a(4),F(" ",r.scheduleApointmentApiProgress()?"Scheduling...":"Schedule","")}},dependencies:[Ne,ye,_e,Se,be,Ee,Fe,we,Ae,Te,xe,L,q,$],encapsulation:2})};export{De as ScheduleAppointmentComponent};
