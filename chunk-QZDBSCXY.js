import{a as De}from"./chunk-LI5VDDHD.js";import{c as T,d as Ie,e as Z,f as Me}from"./chunk-5L7HWFDQ.js";import{a as _e,b as S,c as Ce,d as Se,e as be,f as Y,h as C,i as ye,k as Ae,l as xe,m as Te,n as Ee,o as we,p as Fe,q as Ne,r as ke,s as Pe,t as Ve}from"./chunk-UDXH2DWH.js";import{$a as m,Ba as D,Da as de,Ea as ce,Ga as v,Gb as he,H as me,Jb as ge,L as se,Ma as s,Oa as d,Pa as I,Qa as w,R as P,Ra as F,Sa as n,Ta as o,Ua as A,Va as x,Wa as f,X as c,Xa as g,Y as u,a as K,ab as W,b as z,bb as N,db as _,eb as ue,fa as Q,fb as ve,g as ae,ga as V,gb as h,hb as M,ia as E,o as le,qb as X,rb as fe,sa as a,wa as pe,zb as L}from"./chunk-SATRGR2K.js";var Re=(i,t)=>({cp:i,"no-cursor":t}),je=i=>({"selected-border":i}),Ge=(i,t)=>({"muted-text":i,"available-text-label":t}),Be=(i,t)=>({"available-text":i,"unavailable-text":t});function He(i,t){if(i&1){let e=x();n(0,"div",2)(1,"div",3)(2,"a",4),f("click",function(){let l=c(e).$implicit,p=g();return u(l.isAvailable?p.selectSlot(l):"")})("mouseleave",function(){c(e);let l=g();return u(l.elementTouched())}),n(3,"div",5)(4,"h6",6),m(5),o(),n(6,"p",7),m(7),o()()()()()}if(i&2){let e=t.$implicit;s("ngClass",M(6,Re,e.isAvailable,!e.isAvailable)),a(),s("ngClass",h(9,je,e.isSelected)),a(3),s("ngClass",M(11,Ge,!e.isAvailable,e.isAvailable)),a(),N(" ",e.label," "),a(),s("ngClass",M(14,Be,e.isAvailable,!e.isAvailable)),a(),N(" ",e.isAvailable?"Available":"Unavailable"," ")}}var q=class i{slots=Me;bookedSlots=V.required();availableSlots=fe(()=>this.deriveAvailableSlots(this.bookedSlots()));selectedTimeEmitter=Q();touchedEmitter=Q();deriveAvailableSlots(t){return this.slots.map(r=>z(K({},r),{isAvailable:!t.includes(String(r.value))}))}selectSlot(t){this.availableSlots.update(e=>e.map(r=>z(K({},r),{isSelected:r.value==t.value}))),this.selectedTimeEmitter.emit(t.value)}elementTouched(){this.touchedEmitter.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-time-picker"]],inputs:{bookedSlots:[1,"bookedSlots"]},outputs:{selectedTimeEmitter:"selectedTimeEmitter",touchedEmitter:"touchedEmitter"},decls:4,vars:0,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-6","col-md-4","col-lg-3","mb-3",3,"ngClass"],[1,"card","text-center","shadow-sm","time-card",3,"ngClass"],[1,"text-decoration-none",3,"click","mouseleave"],[1,"card-body","pad-4"],[1,"card-title","fw-bold","mb-1",3,"ngClass"],[1,"card-text","small","mb-0",3,"ngClass"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1),w(2,He,8,17,"div",2,I),o()()),e&2&&(a(2),F(r.availableSlots()))},dependencies:[L],styles:[".pad-4[_ngcontent-%COMP%]{padding:4px}.cp[_ngcontent-%COMP%]{cursor:pointer}.no-cursor[_ngcontent-%COMP%]{cursor:not-allowed}.available-text-label[_ngcontent-%COMP%]{background-image:linear-gradient(to right,green,#4caf50);display:inline;-webkit-background-clip:text;background-clip:text;color:transparent}.available-text[_ngcontent-%COMP%]{color:green}.unavailable-text[_ngcontent-%COMP%]{color:#f47a7a}.time-card[_ngcontent-%COMP%]{transition:transform .9s;background-color:#0085f205}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.selected-border[_ngcontent-%COMP%]{border:2px solid green}.muted-text[_ngcontent-%COMP%]{--bs-text-opacity: 1;color:#727a83bf!important}button[_ngcontent-%COMP%]{border:none;padding:0}"]})};var k=class i{http=P(he);selectedDate=E(T(new Date,"MM/dd/yyyy"));availableSlotsForSelectedDate=ge(()=>`checkIfAppointIsAlreadySchedudForToday?date=${this.selectedDate()}`,{defaultValue:[],parse:t=>t.data.filter(l=>l.status==="confirmed").map(l=>l.time)});scheduleAppointment(t){return this.http.post("schedule",t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=se({token:i,factory:i.\u0275fac})};var $=class i{constructor(t){this.ngControl=t}onModelChange(t){this.ngControl&&this.onInputChange(t)}onInputChange(t){let e=t.replace(/\D/g,"");e.length>3&&e.length<=6?e=e.replace(/^(\d{0,3})(\d{0,3})/,"$1-$2"):e.length>6&&e.length<=10&&(e=e.replace(/^(\d{0,3})(\d{0,3})(\d{0,4})/,"$1-$2-$3")),this.ngControl?.valueAccessor?.writeValue(e)}static \u0275fac=function(e){return new(e||i)(pe(Ce,8))};static \u0275dir=de({type:i,selectors:[["","appPhoneNumberMask",""]],hostBindings:function(e,r){e&1&&f("ngModelChange",function(p){return r.onModelChange(p)})}})};var R=class i{transform(t){if(!t||t==="0")return"";let e=t.toString().trim();return/\D/.test(e)?e:e.length===10?`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`:e}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=ce({name:"telephone",type:i,pure:!0})};var Le=[{key:"j",value:"Junk Removal"},{key:"m",value:"Moving"}];var b=i=>({"invalid-label":i}),Je=()=>[1,2,3,4],Ke=(i,t)=>t.key;function ze(i,t){if(i&1){let e=x();n(0,"div",3)(1,"strong"),m(2),o(),n(3,"button",32),f("click",function(){c(e);let l=g();return u(l.closeAlert())}),n(4,"span",33),m(5,"\xD7"),o()()()}if(i&2){let e=g();a(2),W(e.scheduleAppointmentError())}}function Qe(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function We(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Xe(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Ye(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function Ze(i,t){if(i&1&&(n(0,"option",19),m(1),o()),i&2){let e=t.$implicit;s("value",e.key),a(),W(e.value)}}function et(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function tt(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function it(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function nt(i,t){i&1&&(n(0,"div",11),m(1,"This is a required field"),o())}function ot(i,t){i&1&&(n(0,"div",34),A(1,"div",35),o())}function rt(i,t){i&1&&(n(0,"div",27),w(1,ot,2,0,"div",34,I),o()),i&2&&(a(),F(ve(0,Je)))}function at(i,t){if(i&1){let e=x();n(0,"app-time-picker",36),f("selectedTimeEmitter",function(l){c(e);let p=g();return u(p.selectedTime(l))})("touchedEmitter",function(){c(e);let l=g();return u(l.touchedEvent())}),o()}if(i&2){let e=g();s("bookedSlots",e.engagedSlotsList())}}var qe=class i{appointmentApiService=P(k);type=V.required();engagedSlotsList=X(()=>this.appointmentApiService.availableSlotsForSelectedDate.value());engagedSlotsListIsLoading=X(()=>this.appointmentApiService.availableSlotsForSelectedDate.isLoading());appointmentForm;minDate=T(De(new Date,0),Z);scheduleApointmentApiProgress=E(!1);scheduleAppointmentError=E("");unsubscribe=new ae;servicesList=Le;ngOnInit(){console.log(this.type()),this.#t(),this.appointmentForm.get("appointment.date").valueChanges.pipe(le(t=>this.#e(t)),me(this.unsubscribe)).subscribe(t=>{this.appointmentApiService.selectedDate.set(t)})}#e(t){let[e,r,l]=t.split("-").map(Number),p=new Date(e,r-1,l);return T(p,Ie)}#t(){this.appointmentForm=new Y({firstName:new C("",{nonNullable:!0,validators:[S.required]}),lastName:new C("",{nonNullable:!0,validators:[S.required]}),email:new C("",{nonNullable:!0,validators:[S.required]}),phoneNumber:new C("",{nonNullable:!0,validators:[S.required]}),serviceType:new C(this.type(),{nonNullable:!0,validators:[S.required]}),note:new C("",{nonNullable:!0}),appointment:new Y({date:new C(T(new Date,Z),{nonNullable:!0,validators:[S.required]}),time:new C("",{nonNullable:!0,validators:[S.required]})})})}selectedTime(t){this.appointmentForm.get("appointment.time").setValue(t)}onPhoneNumber(){this.appointmentForm.get("phoneNumber").setValue(new R().transform(this.appointmentForm.get("phoneNumber").value))}scheduleAppointment(){if(this.scheduleAppointmentError.set(""),console.log(this.appointmentForm.getRawValue()),this.appointmentForm.valid){this.scheduleApointmentApiProgress.set(!0);let t=this.appointmentForm.getRawValue();t.appointment.date=this.#e(t.appointment.date),t.email=t.email.toLocaleLowerCase(),this.appointmentApiService.scheduleAppointment(t).subscribe({next:e=>this.#n(e),error:e=>this.#i(e)})}else this.appointmentForm.markAllAsTouched()}#i(t){this.scheduleApointmentApiProgress.set(!1),t?.status==409?this.scheduleAppointmentError.set(t?.error?.message):this.scheduleAppointmentError.set("Failed to create Appointment for Technical Reasons. Please try later."),window.scrollTo({top:0,behavior:"smooth"})}#n(t){this.appointmentApiService.availableSlotsForSelectedDate.reload(),this.appointmentForm.reset(),this.scheduleApointmentApiProgress.set(!1)}touchedEvent(){this.appointmentForm.get("appointment.time").touched||this.appointmentForm.get("appointment.time").markAsTouched({emitEvent:!0})}preventTyping(t){t.preventDefault()}closeAlert(){this.scheduleAppointmentError.set("")}ngOnDestroy(){this.unsubscribe.next(!0),this.unsubscribe.complete()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-schedule-appointment"]],inputs:{type:[1,"type"]},features:[ue([k])],decls:79,vars:34,consts:[[1,"info_container"],[1,""],[1,"test-clip"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"container","mt-4"],[3,"formGroup"],[1,"row"],[1,"col-12","col-md-4","mb-3"],[1,"form-floating"],["type","text","id","firstName","formControlName","firstName","placeholder","First Name",1,"form-control","apt-form-control"],["for","firstName",1,"fw-bold",3,"ngClass"],[1,"apt-validation"],["type","text","id","lastName","formControlName","lastName","placeholder","Last Name",1,"form-control","apt-form-control"],["for","lastName",1,"fw-bold",3,"ngClass"],["type","email","id","email","formControlName","email","placeholder","Email",1,"form-control","apt-form-control"],["for","email",1,"fw-bold",3,"ngClass"],["type","tel","minlength","12","maxlength","12","appPhoneNumberMask","","id","phone","formControlName","phoneNumber","placeholder","Phone",1,"form-control","apt-form-control",3,"blur"],["for","phone",1,"fw-bold",3,"ngClass"],["aria-label","Default select example","formControlName","serviceType",1,"form-select"],[3,"value"],["id","note","formControlName","note","rows","1",1,"form-control"],["for","note",1,"fw-bold",3,"ngClass"],["formGroupName","appointment"],["type","date","id","date","formControlName","date",1,"form-control","apt-form-control",3,"keydown","min"],["for","date",1,"fw-bold",3,"ngClass"],[1,"col-12","col-md-12","mb-3"],["for","time",1,"form-label","test-clip",3,"ngClass"],[1,"row","g-3","mt-4"],[3,"bookedSlots"],[1,"col-12","text-end"],[1,"btn","btn-primary","rounded-pill","px-4","shadow-sm",3,"click"],[1,"btn","btn-outline-warning","rounded-pill","px-4","ms-2"],["type","button","data-dismiss","alert","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"col-6","col-md-4","col-lg-3","mb-3"],[1,"skeleton-slot"],[3,"selectedTimeEmitter","touchedEmitter","bookedSlots"]],template:function(e,r){if(e&1){let l=x();n(0,"div",0)(1,"div",1)(2,"div",1)(3,"h4",2),m(4," Schedule Appointmment "),o()(),n(5,"div"),v(6,ze,6,1,"div",3),n(7,"div",4)(8,"form",5)(9,"div",6)(10,"div",7),_(11)(12),n(13,"div",8),A(14,"input",9),n(15,"label",10),m(16,"First Name *"),o()(),v(17,Qe,2,0,"div",11),o(),n(18,"div",7),_(19)(20),n(21,"div",8),A(22,"input",12),n(23,"label",13),m(24,"Last Name *"),o()(),v(25,We,2,0,"div",11),o(),n(26,"div",7),_(27)(28),n(29,"div",8),A(30,"input",14),n(31,"label",15),m(32,"Email address *"),o()(),v(33,Xe,2,0,"div",11),o(),n(34,"div",7),_(35)(36),n(37,"div",8)(38,"input",16),f("blur",function(){return c(l),u(r.onPhoneNumber())}),o(),n(39,"label",17),m(40,"Phone *"),o()(),v(41,Ye,2,0,"div",11),o(),n(42,"div",7),_(43)(44),n(45,"select",18),w(46,Ze,2,2,"option",19,Ke),o(),v(48,et,2,0,"div",11),o(),n(49,"div",7),_(50)(51),n(52,"div",8),A(53,"textarea",20),n(54,"label",21),m(55,"Notes *"),o()(),v(56,tt,2,0,"div",11),o(),n(57,"div",22)(58,"div",7),_(59)(60),n(61,"div",8)(62,"input",23),f("keydown",function(y){return c(l),u(r.preventTyping(y))}),o(),n(63,"label",24),m(64,"Appointment Date *"),o()(),v(65,it,2,0,"div",11),o(),n(66,"div",25),_(67)(68),n(69,"label",26),m(70,"Appointment Time *"),o(),v(71,nt,2,0,"div",11)(72,rt,3,1,"div",27)(73,at,1,1,"app-time-picker",28),o()(),n(74,"div",29)(75,"button",30),f("click",function(){return c(l),u(r.scheduleAppointment())}),m(76),o(),n(77,"button",31),m(78,"Cancel"),o()()()()()()()()}if(e&2){a(6),d(r.scheduleAppointmentError()?6:-1),a(2),s("formGroup",r.appointmentForm);let l=r.appointmentForm.get("firstName"),p=l.touched&&l.invalid&&l.hasError("required");a(7),s("ngClass",h(20,b,p)),a(2),d(p?17:-1);let y=r.appointmentForm.get("lastName"),ee=y.touched&&y.invalid&&y.hasError("required");a(6),s("ngClass",h(22,b,ee)),a(2),d(ee?25:-1);let j=r.appointmentForm.get("email"),te=j.touched&&j.invalid&&j.hasError("required");a(6),s("ngClass",h(24,b,te)),a(2),d(te?33:-1);let G=r.appointmentForm.get("phoneNumber"),ie=G.touched&&G.invalid&&G.hasError("required");a(6),s("ngClass",h(26,b,ie)),a(2),d(ie?41:-1);let B=r.appointmentForm.get("serviceType"),Oe=B.touched&&B.invalid&&B.hasError("required");a(5),F(r.servicesList),a(2),d(Oe?48:-1);let H=r.appointmentForm.get("note"),ne=H.touched&&H.invalid&&H.hasError("required");a(6),s("ngClass",h(28,b,ne)),a(2),d(ne?56:-1);let U=r.appointmentForm.get("appointment.date"),oe=U.touched&&U.invalid&&U.hasError("required");a(6),s("min",r.minDate),a(),s("ngClass",h(30,b,oe)),a(2),d(oe?65:-1);let J=r.appointmentForm.get("appointment.time"),re=J.touched&&J.invalid&&J.hasError("required");a(4),s("ngClass",h(32,b,re)),a(2),d(re?71:-1),a(),d(r.engagedSlotsListIsLoading()?72:73),a(4),N(" ",r.scheduleApointmentApiProgress()?"Scheduling...":"Schedule","")}},dependencies:[Pe,ye,we,Fe,_e,Ee,Se,be,Ne,ke,Ve,Ae,Te,xe,q,L,$],encapsulation:2})};export{qe as ScheduleAppointmentComponent};
