import{a as we}from"./chunk-UGFCKRAL.js";import{c as x,d as Fe,e as Q,f as Ne}from"./chunk-6GU44J6F.js";import{a as fe,b,c as ve,d as ge,e as _e,f as J,h as _,i as Ce,k as be,l as Se,m as Ae,n as xe,o as ye,p as Ee,q as Te}from"./chunk-7TTQBNPS.js";import{$a as m,Ba as k,Da as le,Ea as me,Fb as ue,Ga as g,H as ne,Ib as he,L as oe,Ma as s,Oa as h,Pa as P,Qa as D,R as N,Ra as V,Sa as n,Ta as o,Ua as T,Va as A,Wa as u,X as d,Xa as f,Y as c,a as H,ab as se,b as U,bb as w,db as C,eb as pe,fa as K,fb as de,g as te,ga as re,gb as v,hb as I,ia as E,o as ie,qb as z,rb as ce,sa as a,wa as ae,yb as M}from"./chunk-2PVQT5LA.js";var De=(i,t)=>({cp:i,"no-cursor":t}),Ve=i=>({"selected-border":i}),Ie=(i,t)=>({"muted-text":i,"available-text-label":t}),Me=(i,t)=>({"available-text":i,"unavailable-text":t});function Le(i,t){if(i&1){let e=A();n(0,"div",2)(1,"div",3)(2,"a",4),u("click",function(){let l=d(e).$implicit,p=f();return c(l.isAvailable?p.selectSlot(l):"")})("mouseleave",function(){d(e);let l=f();return c(l.elementTouched())}),n(3,"div",5)(4,"h6",6),m(5),o(),n(6,"p",7),m(7),o()()()()()}if(i&2){let e=t.$implicit;s("ngClass",I(6,De,e.isAvailable,!e.isAvailable)),a(),s("ngClass",v(9,Ve,e.isSelected)),a(3),s("ngClass",I(11,Ie,!e.isAvailable,e.isAvailable)),a(),w(" ",e.label," "),a(),s("ngClass",I(14,Me,e.isAvailable,!e.isAvailable)),a(),w(" ",e.isAvailable?"Available":"Unavailable"," ")}}var L=class i{slots=Ne;bookedSlots=re.required();availableSlots=ce(()=>this.deriveAvailableSlots(this.bookedSlots()));selectedTimeEmitter=K();touchedEmitter=K();deriveAvailableSlots(t){return this.slots.map(r=>U(H({},r),{isAvailable:!t.includes(String(r.value))}))}selectSlot(t){this.availableSlots.update(e=>e.map(r=>U(H({},r),{isSelected:r.value==t.value}))),this.selectedTimeEmitter.emit(t.value)}elementTouched(){this.touchedEmitter.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-time-picker"]],inputs:{bookedSlots:[1,"bookedSlots"]},outputs:{selectedTimeEmitter:"selectedTimeEmitter",touchedEmitter:"touchedEmitter"},decls:4,vars:0,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-6","col-md-4","col-lg-3","mb-3",3,"ngClass"],[1,"card","text-center","shadow-sm","time-card",3,"ngClass"],[1,"text-decoration-none",3,"click","mouseleave"],[1,"card-body","pad-4"],[1,"card-title","fw-bold","mb-1",3,"ngClass"],[1,"card-text","small","mb-0",3,"ngClass"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1),D(2,Le,8,17,"div",2,P),o()()),e&2&&(a(2),V(r.availableSlots()))},dependencies:[M],styles:[".pad-4[_ngcontent-%COMP%]{padding:4px}.cp[_ngcontent-%COMP%]{cursor:pointer}.no-cursor[_ngcontent-%COMP%]{cursor:not-allowed}.available-text-label[_ngcontent-%COMP%]{background-image:linear-gradient(to right,green,#4caf50);display:inline;-webkit-background-clip:text;background-clip:text;color:transparent}.available-text[_ngcontent-%COMP%]{color:green}.unavailable-text[_ngcontent-%COMP%]{color:#f47a7a}.time-card[_ngcontent-%COMP%]{transition:transform .9s;background-color:#0085f205}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.selected-border[_ngcontent-%COMP%]{border:2px solid green}.muted-text[_ngcontent-%COMP%]{--bs-text-opacity: 1;color:#727a83bf!important}button[_ngcontent-%COMP%]{border:none;padding:0}"]})};var F=class i{http=N(ue);selectedDate=E(x(new Date,"MM/dd/yyyy"));availableSlotsForSelectedDate=he(()=>({url:`checkIfAppointIsAlreadySchedudForToday?date=${this.selectedDate()}`,method:"GET"}),{defaultValue:[],parse:t=>t.data.filter(l=>l.status==="confirmed").map(l=>l.time)});scheduleAppointment(t){return this.http.post("schedule",t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=oe({token:i,factory:i.\u0275fac})};var O=class i{constructor(t){this.ngControl=t}onModelChange(t){this.ngControl&&this.onInputChange(t)}onInputChange(t){let e=t.replace(/\D/g,"");e.length>3&&e.length<=6?e=e.replace(/^(\d{0,3})(\d{0,3})/,"$1-$2"):e.length>6&&e.length<=10&&(e=e.replace(/^(\d{0,3})(\d{0,3})(\d{0,4})/,"$1-$2-$3")),this.ngControl?.valueAccessor?.writeValue(e)}static \u0275fac=function(e){return new(e||i)(ae(ve,8))};static \u0275dir=le({type:i,selectors:[["","appPhoneNumberMask",""]],hostBindings:function(e,r){e&1&&u("ngModelChange",function(p){return r.onModelChange(p)})}})};var $=class i{transform(t){if(!t||t==="0")return"";let e=t.toString().trim();return/\D/.test(e)?e:e.length===10?`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`:e}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=me({name:"telephone",type:i,pure:!0})};var y=i=>({"invalid-label":i}),Oe=()=>[1,2,3,4];function $e(i,t){if(i&1){let e=A();n(0,"div",5)(1,"strong"),m(2),o(),n(3,"button",30),u("click",function(){d(e);let l=f();return c(l.closeAlert())}),n(4,"span",31),m(5,"\xD7"),o()()()}if(i&2){let e=f();a(2),se(e.scheduleAppointmentError())}}function Ge(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function Re(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function je(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function Be(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function He(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function Ue(i,t){i&1&&(n(0,"div",13),m(1,"This is a required field"),o())}function Ke(i,t){i&1&&(n(0,"div",32),T(1,"div",33),o())}function ze(i,t){i&1&&(n(0,"div",25),D(1,Ke,2,0,"div",32,P),o()),i&2&&(a(),V(de(0,Oe)))}function Je(i,t){if(i&1){let e=A();n(0,"app-time-picker",34),u("selectedTimeEmitter",function(l){d(e);let p=f();return c(p.selectedTime(l))})("touchedEmitter",function(){d(e);let l=f();return c(l.touchedEvent())}),o()}if(i&2){let e=f();s("bookedSlots",e.engagedSlotsList())}}var ke=class i{appointmentApiService=N(F);engagedSlotsList=z(()=>this.appointmentApiService.availableSlotsForSelectedDate.value());engagedSlotsListIsLoading=z(()=>this.appointmentApiService.availableSlotsForSelectedDate.isLoading());appointmentForm;minDate=x(we(new Date,0),Q);scheduleApointmentApiProgress=E(!1);scheduleAppointmentError=E("");unsubscribe=new te;ngOnInit(){this.#t(),this.appointmentForm.get("appointment.date").valueChanges.pipe(ie(t=>this.#e(t)),ne(this.unsubscribe)).subscribe(t=>{this.appointmentApiService.selectedDate.set(t)})}#e(t){let[e,r,l]=t.split("-").map(Number),p=new Date(e,r-1,l);return x(p,Fe)}#t(){this.appointmentForm=new J({firstName:new _("",{nonNullable:!0,validators:[b.required]}),lastName:new _("",{nonNullable:!0,validators:[b.required]}),email:new _("",{nonNullable:!0,validators:[b.required]}),phoneNumber:new _("",{nonNullable:!0,validators:[b.required]}),note:new _("",{nonNullable:!0}),appointment:new J({date:new _(x(new Date,Q),{nonNullable:!0,validators:[b.required]}),time:new _("",{nonNullable:!0,validators:[b.required]})})})}selectedTime(t){this.appointmentForm.get("appointment.time").setValue(t)}onPhoneNumber(){this.appointmentForm.get("phoneNumber").setValue(new $().transform(this.appointmentForm.get("phoneNumber").value))}scheduleAppointment(){if(this.scheduleAppointmentError.set(""),console.log(this.appointmentForm.getRawValue()),this.appointmentForm.valid){this.scheduleApointmentApiProgress.set(!0);let t=this.appointmentForm.getRawValue();t.appointment.date=this.#e(t.appointment.date),t.email=t.email.toLocaleLowerCase(),this.appointmentApiService.scheduleAppointment(t).subscribe({next:e=>this.#n(e),error:e=>this.#i(e)})}else this.appointmentForm.markAllAsTouched()}#i(t){this.scheduleApointmentApiProgress.set(!1),t?.status==409?this.scheduleAppointmentError.set(t?.error?.message):this.scheduleAppointmentError.set("Failed to create Appointment for Technical Reasons. Please try later."),window.scrollTo({top:0,behavior:"smooth"})}#n(t){this.appointmentApiService.availableSlotsForSelectedDate.reload(),this.appointmentForm.reset(),this.scheduleApointmentApiProgress.set(!1)}touchedEvent(){this.appointmentForm.get("appointment.time").touched||this.appointmentForm.get("appointment.time").markAsTouched({emitEvent:!0})}preventTyping(t){t.preventDefault()}closeAlert(){this.scheduleAppointmentError.set("")}ngOnDestroy(){this.unsubscribe.next(!0),this.unsubscribe.complete()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-schedule-appointment"]],features:[pe([F])],decls:64,vars:29,consts:[[1,"info_container"],[1,"card","card-shadow"],[1,"card-header"],[1,"test-clip"],[1,"card-body"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"container","mt-4"],[3,"formGroup"],[1,"row"],[1,"col-12","col-md-6","mb-3"],[1,"form-floating"],["type","text","id","firstName","formControlName","firstName","placeholder","First Name",1,"form-control","apt-form-control"],["for","firstName",3,"ngClass"],[1,"apt-validation"],["type","text","id","lastName","formControlName","lastName","placeholder","Last Name",1,"form-control","apt-form-control"],["for","lastName",3,"ngClass"],["type","email","id","email","formControlName","email","placeholder","Email",1,"form-control","apt-form-control"],["for","email",3,"ngClass"],["type","tel","minlength","12","maxlength","12","appPhoneNumberMask","","id","phone","formControlName","phoneNumber","placeholder","Phone",1,"form-control","apt-form-control",3,"blur"],["for","phone",3,"ngClass"],["formGroupName","appointment",1,"row"],["type","date","id","date","formControlName","date",1,"form-control","apt-form-control",3,"keydown","min"],["for","date",3,"ngClass"],[1,"col-12","col-md-12","mb-3"],["for","time",1,"form-label","test-clip",3,"ngClass"],[1,"row","g-3","mt-4"],[3,"bookedSlots"],[1,"col-12","text-end"],[1,"btn","btn-primary","rounded-pill","px-4","shadow-sm",3,"click"],[1,"btn","btn-outline-warning","rounded-pill","px-4","ms-2"],["type","button","data-dismiss","alert","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"col-6","col-md-4","col-lg-3","mb-3"],[1,"skeleton-slot"],[3,"selectedTimeEmitter","touchedEmitter","bookedSlots"]],template:function(e,r){if(e&1){let l=A();n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),m(4," Schedule Appointmment "),o()(),n(5,"div",4),g(6,$e,6,1,"div",5),n(7,"div",6)(8,"form",7)(9,"div",8)(10,"div",9),C(11)(12),n(13,"div",10),T(14,"input",11),n(15,"label",12),m(16,"First Name *"),o()(),g(17,Ge,2,0,"div",13),o(),n(18,"div",9),C(19)(20),n(21,"div",10),T(22,"input",14),n(23,"label",15),m(24,"Last Name *"),o()(),g(25,Re,2,0,"div",13),o(),n(26,"div",9),C(27)(28),n(29,"div",10),T(30,"input",16),n(31,"label",17),m(32,"Email address *"),o()(),g(33,je,2,0,"div",13),o(),n(34,"div",9),C(35)(36),n(37,"div",10)(38,"input",18),u("blur",function(){return d(l),c(r.onPhoneNumber())}),o(),n(39,"label",19),m(40,"Phone *"),o()(),g(41,Be,2,0,"div",13),o(),n(42,"div",20)(43,"div",9),C(44)(45),n(46,"div",10)(47,"input",21),u("keydown",function(S){return d(l),c(r.preventTyping(S))}),o(),n(48,"label",22),m(49,"Appointment Date *"),o()(),g(50,He,2,0,"div",13),o(),n(51,"div",23),C(52)(53),n(54,"label",24),m(55,"Appointment Time *"),o(),g(56,Ue,2,0,"div",13)(57,ze,3,1,"div",25)(58,Je,1,1,"app-time-picker",26),o()(),n(59,"div",27)(60,"button",28),u("click",function(){return d(l),c(r.scheduleAppointment())}),m(61),o(),n(62,"button",29),m(63,"Cancel"),o()()()()()()()()}if(e&2){a(6),h(r.scheduleAppointmentError()?6:-1),a(2),s("formGroup",r.appointmentForm);let l=r.appointmentForm.get("firstName"),p=l.touched&&l.invalid&&l.hasError("required");a(7),s("ngClass",v(17,y,p)),a(2),h(p?17:-1);let S=r.appointmentForm.get("lastName"),W=S.touched&&S.invalid&&S.hasError("required");a(6),s("ngClass",v(19,y,W)),a(2),h(W?25:-1);let G=r.appointmentForm.get("email"),X=G.touched&&G.invalid&&G.hasError("required");a(6),s("ngClass",v(21,y,X)),a(2),h(X?33:-1);let R=r.appointmentForm.get("phoneNumber"),Y=R.touched&&R.invalid&&R.hasError("required");a(6),s("ngClass",v(23,y,Y)),a(2),h(Y?41:-1);let j=r.appointmentForm.get("appointment.date"),Z=j.touched&&j.invalid&&j.hasError("required");a(6),s("min",r.minDate),a(),s("ngClass",v(25,y,Z)),a(2),h(Z?50:-1);let B=r.appointmentForm.get("appointment.time"),ee=B.touched&&B.invalid&&B.hasError("required");a(4),s("ngClass",v(27,y,ee)),a(2),h(ee?56:-1),a(),h(r.engagedSlotsListIsLoading()?57:58),a(4),w(" ",r.scheduleApointmentApiProgress()?"Scheduling...":"Schedule","")}},dependencies:[Ee,Ce,fe,ge,_e,xe,ye,Te,be,Ae,Se,L,M,O],encapsulation:2})};export{ke as ScheduleAppointmentComponent};
